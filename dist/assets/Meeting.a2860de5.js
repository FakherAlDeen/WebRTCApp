import{r as u,w as T,k as U,o as r,c as m,a as n,t as x,d as h,u as me,U as a,b as i,q as A,y as de,s as D,e as P,F as I,z,l as fe,T as ge,f as ve,g as F,m as J,v as pe,p as be,j as he,_ as Y}from"./index.35e50974.js";import{D as _e}from"./SharedDocYjs.1fd49aca.js";import{C as ke}from"./chatBubble.b7bf9e26.js";import{_ as ye}from"./_plugin-vue_export-helper.cdc0426e.js";const xe={class:"relative bg-white rounded-lg overflow-hidden"},we=["id"],De=["muted",".srcObject"],Ce=["id"],Se={__name:"Video",props:{strmObj:{type:MediaStream},conID:{type:String},userid:{type:String},me:{type:Boolean},room:{type:String}},setup(g){const d=g;return u(),console.log("smth///////////////////////////////",d.strmObj.getTracks().find(c=>c.kind=="audio").enabled),T(()=>d.strmObj,(c,v)=>{console.log("watcher vid"),console.log(c),console.log(v)}),U(()=>{let c=u();console.log(d.me),d.me&&(c.muted="true")}),(c,v)=>(r(),m("div",xe,[n("span",{class:"absolute badge badge-lg z-10",id:d.userid},x(d.conID),9,we),n("video",{muted:g.me,ref:"vid",".srcObject":g.strmObj,class:"w-full z-0",style:{"{transform":"rotateY(180deg)","-webkit-transform":"rotateY(180deg)","-moz-transform":"rotateY(180deg)"},autoplay:""},null,8,De),d.strmObj.getTracks().find(o=>o.kind=="audio").enabled?h("",!0):(r(),m("span",{key:0,class:"absolute badge badge-lg z-10 bottom-1 right-1",id:d.userid},"muted",8,Ce))]))}};const B=g=>(be("data-v-75816ceb"),g=g(),he(),g),Oe={class:"flex flex-col h-full"},Ie={class:"flex items-end mb-5"},Me={class:"text-3xl font-light mt-10 ml-10"},Ne=ve("Meeting "),Le={class:"font-light text-base text-gray-500"},He={class:"font-light text-base text-gray-500 ml-4 mb-[1px]"},Re={class:"bg-base-200 flex h-full"},je={key:0,class:"flex flex-col justify-center items-center justify-items-center content-center h-full"},ze={key:1,class:"w-full h-full"},Be=B(()=>n("img",{class:"w-5 mr-1",src:Y},null,-1)),Ee=[Be],$e={key:2,class:"w-full h-full"},We={key:0,class:"overflow-y-auto w-[90%] max-h-[40rem] mx-auto mt-5"},Ae={class:"table w-full"},Pe=B(()=>n("thead",null,[n("tr",null,[n("th",{class:"text-center"},"Document Name"),n("th",{class:"text-center"},"Actions")])],-1)),Fe={class:"bg-gray-200 text-center"},Je=["onClick"],Te={key:1,class:"card-title text-slate-500 font-light text-base"},Ue=B(()=>n("img",{class:"w-5 mr-1",src:Y},null,-1)),Ye=[Ue],Ve={class:"w-full h-fit max-h-[690px] grid m-auto gap-4 grid-cols-2 grid-rows-2 m-10"},qe={key:0,class:"h-full w-1/3 bg-white fixed right-0 top-0 drop-shadow inner z-10"},Ge={class:"flex flex-col h-5/6 relative top-20 items-center text-center"},Ke={class:"grow w-full overflow-auto"},Qe={__name:"Meeting",setup(g){const d=me();a().pageImIn="meeting";let c=d.params.RoomID,v=d.params.RoomName;console.log(d.params),console.log("room meeting",c),a().IsAGuest||(a().getNotificationList(),a().getRequestList());const o=a(),M=u(!1),w=u(),_=u("");u(!0);const C=u([]),N=u(!1),L=u("turn off cam"),H=u(!1),R=u("turn off Mic");let j=null;a().pageImIn="Meeting";function V(){let e=j.getTracks().find(t=>t.kind=="video");console.log("strmEvents",w.value),e.enabled?(e.enabled=!1,N.value=!1,L.value="turn on cam"):e.enabled||(e.enabled=!0,N.value=!0,L.value="turn off cam")}function q(){let e=j.getTracks().find(t=>t.kind=="audio");e.enabled?(e.enabled=!1,H.value=!1,R.value="turn on Mic"):(e.enabled=!0,H.value=!0,R.value="turn off Mic")}const p=u(!1),k=u(!1),y=u(!1),S=u(c),O=u(v);function G(e,t){S.value=e,O.value=t,k.value=!0,y.value=!1}function K(){p.value=!p.value}function Q(){a().LastDocument&&(S.value=a().LastDocument,O.value=a().LastDocumentName,k.value=!0)}function X(){y.value=!0}function Z(){O.value=v,a().CreateDocument(v);let e=null;T(()=>a().ServerAns,(t,s)=>{e=t,console.log("ser",e),e.stringAns=="Done!"&&(S.value=e.id)}),k.value=!0}console.log(c);const ee=u({});let l={};l[o.userID]={name:o.userDetails.Fname+" "+o.userDetails.Lname};const te={video:{width:{max:9e3},height:{max:9e3},frameRate:{max:100}},audio:!0},se={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10};U(()=>{navigator.mediaDevices.getUserMedia(te).then(async e=>{j=e,o.localStream=e,w.value=e,a().streamEvents[o.userID]=e}).then(()=>{o.setupSocket()}).then(()=>{o.socketW.on("connect",function(e){o.socketW.emit("msg",JSON.stringify({room:c,IsSDPICE:"no",from:o.userID,to:"any",name:o.userDetails.Fname+" "+o.userDetails.Lname}))}),o.socketW.on("datafromserv",e=>{ne(e)})}),a().LastMeeting=c,a().LastMeetingName=v});async function ne(e){var t=JSON.parse(e);let s=t.from;if(!t.flag){if(t.type){ce(t),console.log("wtv");return}s==o.userID||t.to!=o.userID&&t.to!="any"||(t.to=="any"?(E(s,c,t.name),o.socketW.emit("msg",JSON.stringify({room:c,IsSDPICE:"no",from:o.userID,to:s,name:o.userDetails.Fname+" "+o.userDetails.Lname}))):t.IsSDPICE=="no"&&t.to==o.userID?E(s,c,t.name,!0):t.sdp?l[s].pc.setRemoteDescription(new RTCSessionDescription(t.sdp)).then(function(){t.sdp.type=="offer"&&l[s].pc.createAnswer().then(f=>$(f,s,c))}):t.ice&&l[s].pc.addIceCandidate(new RTCIceCandidate(t.ice)))}}function E(e,t,s,f=!1){l[e]={otherID:e,pc:new RTCPeerConnection(se),name:s},l[e].pc.onicecandidate=b=>ae(b,e,t),l[e].pc.ontrack=b=>oe(b,e),l[e].pc.oniceconnectionstatechange=b=>le(b,e),l[e].pc.addStream(o.localStream),f&&l[e].pc.createOffer().then(b=>$(b,e,t))}function oe(e,t){a().streamEvents[t]=e.streams[0],console.log("stream ",ee)}function ae(e,t,s){e.candidate!=null&&o.socketW.emit("msg",JSON.stringify({room:s,ice:e.candidate,to:t,from:o.userID}))}function $(e,t,s){l[t].pc.setLocalDescription(e).then(function(){l[t].pc.localDescription!=null&&o.socketW.emit("msg",JSON.stringify({room:s,sdp:l[t].pc.localDescription,from:o.userID,to:t}))})}function le(e,t){let s=l[t].pc.iceConnectionState;console.log(`connection with peer ${t} ${s}`),(s==="failed"||s==="closed"||s==="disconnected")&&(document.getElementById(t).innerHTML="Disconnected!",delete l[t],delete a().streamEvents[t])}function ce(e){C.value.push({from:e.from,msg:e.msg,name:e.name}),console.log(C.value)}function W(){M.value=!M.value}function re(){if(_.value=="")return;console.log(_.value);let e={room:c,type:"chat",from:o.userID,name:o.userDetails.Fname+" "+o.userDetails.Lname,msg:_.value};C.value.push({from:e.from,msg:e.msg,name:e.name}),o.socketW.emit("msg",JSON.stringify(e)),_.value=""}function ie(){for(const e in l)console.log("val",e),e!=a().userID&&l[e].pc.close(),delete w.value,console.log(w.value);l=null,w.value=null,F.push("/list")}const ue=()=>{F.push("/MeetingHistory")};return(e,t)=>(r(),m("div",Oe,[n("div",Ie,[n("p",Me,[Ne,n("span",Le,"Room Name: '"+x(i(v))+"'",1)]),n("p",He,"Sharing ID: "+x(i(c)),1),i(a)().IsAGuest?h("",!0):(r(),m("button",{key:0,onClick:ue,class:"btn absolute right-[9rem] top-[46%]"},"Meeting History"))]),n("div",Re,[A(n("div",{class:D(["bg-white m-5 rounded-3xl drop-shadow-xl",{"w-1/3":i(a)().navBarOn,"w-1/4":!i(a)().navBarOn}])},[!i(d).params.TakeMeWith&&!k.value&&!y.value?(r(),m("div",je,[n("button",{class:"btn m-5",onClick:Q},"open last document"),n("button",{class:"btn m-5",onClick:X},"choose from your docs"),n("button",{class:"btn btn-warning max-w-[70%] m-5",onClick:Z},"create a new one with the meeting")])):i(d).params.TakeMeWith||k.value?(r(),m("div",ze,[n("button",{class:"btn btn-ghost btn-circle absolute z-20 bottom-9 left-7",onClick:t[0]||(t[0]=s=>k.value=!1)},Ee),P(_e,{takemewithyou:!1,onOnClose:t[1]||(t[1]=s=>p.value=!1),DocName:O.value,room:S.value,withClose:!0,open:p.value},null,8,["DocName","room","open"])])):h("",!0),y.value?(r(),m("div",$e,[i(a)().DocumentHistoryList.length>0?(r(),m("div",We,[n("table",Ae,[Pe,n("tbody",Fe,[(r(!0),m(I,null,z(i(a)().DocumentHistoryList,s=>(r(),m("tr",{key:s},[n("td",null,x(s.Name),1),n("td",null,[n("button",{class:"btn btn-xs m-1",onClick:f=>G(s.RoomID,s.Name)},"Open",8,Je)])]))),128))])])])):(r(),m("h1",Te,"You never made any document yet :c")),y.value?(r(),m("button",{key:2,class:"btn btn-ghost btn-circle fixed z-20 bottom-9 left-7",onClick:t[2]||(t[2]=s=>y.value=!1)},Ye)):h("",!0)])):h("",!0)],2),[[de,p.value]]),n("div",Ve,[(r(!0),m(I,null,z(i(a)().streamEvents,(s,f)=>(r(),m(I,{key:f},[i(l)[f].name?(r(),J(Se,{key:0,strmObj:s,conID:i(l)[f].name,userid:f,me:f==i(a)().userID,room:i(c)},null,8,["strmObj","conID","userid","me","room"])):h("",!0)],64))),128))]),P(ge,{duration:"550",name:"slide"},{default:fe(()=>[M.value?(r(),m("div",qe,[n("label",{class:"btn btn-sm btn-circle absolute left-2 top-2",onClick:W},"\u2715"),n("div",Ge,[n("div",Ke,[(r(!0),m(I,null,z(C.value,s=>(r(),J(ke,{key:s,msg:s.msg,me:s.from==i(o).userID,name:s.name},null,8,["msg","me","name"]))),128))]),n("div",null,[A(n("input",{type:"text",placeholder:"Type here",class:"input input-bordered input-primary w-full max-w-xs z-20 m-auto","onUpdate:modelValue":t[3]||(t[3]=s=>_.value=s)},null,512),[[pe,_.value]]),n("button",{class:"btn btn-active btn-primary w-1/4 mt-5",onClick:re},"Send!")])])])):h("",!0)]),_:1}),n("div",{class:D(["absolute bottom-2",{"left-[30%]":!i(a)().navBarOn||p.value,"left-[26%]":i(a)().navBarOn&&!p.value}])},[n("button",{class:"btn btn-error m-3",onClick:ie},"Disconnect"),n("button",{class:D(["btn m-3",{"btn-error":N.value}]),onClick:V},x(L.value),3),n("button",{class:D(["btn m-3",{"btn-error":H.value}]),onClick:q},x(R.value),3),n("button",{class:D(["btn m-3",{"btn-error":p.value}]),onClick:K},"Open Shared Document",2),n("button",{class:"btn m-3 btn-primary",onClick:W},"chat!")],2)])]))}},st=ye(Qe,[["__scopeId","data-v-75816ceb"]]);export{st as default};
